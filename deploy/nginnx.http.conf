worker_processes  1;

events { worker_connections 1024; }

http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile      on;

  server {
    listen 80;
    server_name _;

    # Отдаём ACME challenge без редиректа
    location ^~ /.well-known/acme-challenge/ {
      root /var/www/certbot;
      default_type "text/plain";
    }

    # Остальные запросы — редиректим на HTTPS (для пользователей/проверок)
    location / {
      return 301 https://$host$request_uri;
    }
  }

  # Прокси на backend на 8000 для локальных проверок (не обязателен на http)
  upstream backend { server 127.0.0.1:8000; }
}
